<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Min Valentine üíò</title>
  <style>
    :root{
      --bg1:#ffb3c7;
      --bg2:#ffd6e5;
      --bg3:#fff1f6;
      --text:#2a0f1e;
      --shadow: 0 18px 50px rgba(0,0,0,.18);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; color:var(--text); }

    body{
      display:grid;
      place-items:center;
      overflow:hidden;
      background:
        radial-gradient(1200px 800px at 15% 20%, var(--bg3), transparent 60%),
        radial-gradient(900px 700px at 85% 30%, #ffe6ef, transparent 55%),
        radial-gradient(1000px 900px at 50% 90%, #fff, transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
    }

    .hearts{
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.55;
      filter: blur(.2px);
      background:
        radial-gradient(circle at 15% 25%, rgba(255,255,255,.55) 0 18px, transparent 20px),
        radial-gradient(circle at 75% 20%, rgba(255,255,255,.45) 0 14px, transparent 16px),
        radial-gradient(circle at 35% 70%, rgba(255,255,255,.35) 0 20px, transparent 22px),
        radial-gradient(circle at 85% 75%, rgba(255,255,255,.30) 0 18px, transparent 20px);
      animation: floaty 8s ease-in-out infinite alternate;
    }
    @keyframes floaty{
      from{ transform: translateY(0px); }
      to{ transform: translateY(-18px); }
    }

    .card{
      width:min(720px, 92vw);
      border-radius: 28px;
      padding: clamp(18px, 4vw, 34px);
      background: rgba(255,255,255,.72);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      position:relative;
      z-index:2;
    }

    .title{
      margin:0 0 10px;
      font-size: clamp(28px, 4.2vw, 44px);
      letter-spacing: .3px;
    }

    .subtitle{
      margin:0 0 22px;
      font-size: clamp(14px, 2.2vw, 18px);
      opacity:.9;
      line-height:1.35;
    }

    .question{
      font-size: clamp(18px, 2.8vw, 24px);
      margin: 12px 0 18px;
      font-weight: 700;
    }

    .buttons{
      display:flex;
      gap: 14px;
      flex-wrap:wrap;
      align-items:center;
    }

    button{
      border:0;
      border-radius: 999px;
      padding: 14px 20px;
      font-size: 18px;
      font-weight: 800;
      cursor:pointer;
      transform: translateZ(0);
      transition: transform .12s ease, box-shadow .12s ease, filter .12s ease, opacity .12s ease;
      box-shadow: 0 10px 25px rgba(0,0,0,.14);
      user-select:none;
    }
    button:active{ transform: scale(.98); }

    #yesBtn{
      background: linear-gradient(180deg, #2ee59d, #16c47f);
      color: #062015;
    }
    #noBtn{
      background: linear-gradient(180deg, #ff6b8f, #ff3f73);
      color: #2b0010;
      font-weight:900;
    }
    #yesBtn:hover, #noBtn:hover { filter: brightness(1.03); }

    /* Party mode */
    body.party{
      animation: partyBg 2.8s linear infinite;
    }
    @keyframes partyBg{
      0%{ filter:hue-rotate(0deg) saturate(1.1); }
      100%{ filter:hue-rotate(360deg) saturate(1.2); }
    }

    .yay{
      display:none;
      margin-top: 18px;
      padding: 14px 16px;
      border-radius: 20px;
      background: rgba(255,255,255,.78);
      border: 2px dashed rgba(0,0,0,.15);
      font-size: clamp(18px, 3.3vw, 28px);
      font-weight: 900;
      text-align:center;
    }
    .yay.show{ display:block; }

    .sparkle{
      position:absolute;
      top:-12px; right:-12px;
      width: 86px; height:86px;
      border-radius: 26px;
      background: rgba(255,255,255,.6);
      display:grid;
      place-items:center;
      transform: rotate(8deg);
      box-shadow: 0 10px 25px rgba(0,0,0,.12);
      font-size: 34px;
    }

    canvas#confetti{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index: 5;
    }

    /* GIF fade-in */
    .gifWrap{
      display:none;
      margin: 16px auto 0;
      width: min(320px, 78%);
      border-radius: 16px;
      overflow:hidden;
      box-shadow: 0 8px 28px rgba(0,0,0,.18);
      background: rgba(255,255,255,.55);
    }
    .gifWrap.show{ display:block; }

    .gifWrap img{
      width:100%;
      display:block;

      /* start state */
      opacity: 0;
      transform: scale(.92);
      transition: opacity 520ms ease, transform 520ms cubic-bezier(.2,1.1,.2,1);

      /* snyggt om den laddar lite l√•ngsamt */
      will-change: opacity, transform;
    }
    .gifWrap.show img{
      opacity: 1;
      transform: scale(1);
    }
  </style>
</head>

<body>
  <div class="hearts" aria-hidden="true"></div>
  <canvas id="confetti"></canvas>

  <main class="card">
    <div class="sparkle" aria-hidden="true">üíñ</div>

    <h1 class="title">Hej poki üíò</h1>
    <p class="subtitle">Jag har en superviktig fr√•ga‚Ä¶</p>

    <div class="question">Vill du vara min Valentine? üåπ</div>

    <div class="buttons">
      <button id="yesBtn" type="button">JA!! ü•∞</button>
      <button id="noBtn" type="button">Nej üò≥</button>
    </div>

    <div id="yay" class="yay">YAAAY!!! üéâüíÉüï∫</div>

    <!-- GIF (g√∂md tills JA) -->
    <div id="gifWrap" class="gifWrap" aria-hidden="true">
      <img
        id="danceGif"
        src="https://media.tenor.com/dfiJQjiNVoQAAAAj/cockroach-dance.gif"
        alt="Cockroach dance"
        loading="lazy"
        decoding="async"
      />
    </div>
  </main>

  <script>
    const yesBtn = document.getElementById("yesBtn");
    const noBtn  = document.getElementById("noBtn");
    const yay    = document.getElementById("yay");
    const gifWrap = document.getElementById("gifWrap");
    const danceGif = document.getElementById("danceGif");

    const canvas = document.getElementById("confetti");
    const ctx    = canvas.getContext("2d");

    let yesScale = 1;
    let noScale  = 1;

    function resizeCanvas(){
      canvas.width = window.innerWidth * devicePixelRatio;
      canvas.height = window.innerHeight * devicePixelRatio;
      ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    // "Nej" -> "Ja" blir st√∂rre (och nej krymper lite)
    noBtn.addEventListener("click", () => {
      yesScale = Math.min(yesScale + 0.18, 3.2);
      noScale  = Math.max(noScale - 0.06, 0.72);

      yesBtn.style.transform = `scale(${yesScale})`;
      noBtn.style.transform  = `scale(${noScale})`;

      noBtn.animate(
        [
          {transform:`scale(${noScale}) translateX(0px)`},
          {transform:`scale(${noScale}) translateX(-6px)`},
          {transform:`scale(${noScale}) translateX(6px)`},
          {transform:`scale(${noScale}) translateX(0px)`}
        ],
        {duration: 220, iterations: 1}
      );
    });

    // ----------------------------
    // PARTY AUDIO: Mariachi-ish ü•Åüé∫
    // ----------------------------
    let audioStarted = false;

    async function playLaCucarachaMariachi(){
      if (audioStarted) return;
      audioStarted = true;

      const AudioContext = window.AudioContext || window.webkitAudioContext;
      const ac = new AudioContext();
      if (ac.state === "suspended") await ac.resume();

      // Master
      const master = ac.createGain();
      master.gain.value = 0.95;

      // ‚ÄúGlue‚Äù / soft saturation
      const shaper = ac.createWaveShaper();
      shaper.curve = (function makeCurve(amount = 14){
        const n = 44100, curve = new Float32Array(n);
        for (let i=0; i<n; i++){
          const x = (i * 2) / (n - 1) - 1;
          curve[i] = Math.tanh(amount * x) / Math.tanh(amount);
        }
        return curve;
      })();

      // Tiny room (delay) for space
      const delay = ac.createDelay(1.0);
      delay.delayTime.value = 0.085;
      const fb = ac.createGain();
      fb.gain.value = 0.22;
      delay.connect(fb);
      fb.connect(delay);

      const wet = ac.createGain(); wet.gain.value = 0.18;
      const dry = ac.createGain(); dry.gain.value = 1.0;

      master.connect(dry);
      master.connect(delay);
      delay.connect(wet);

      const out = ac.createGain();
      out.gain.value = 0.16; // overall volume
      dry.connect(out);
      wet.connect(out);
      out.connect(shaper);
      shaper.connect(ac.destination);

      // Notes (Hz)
      const N = {
        C4:261.63, D4:293.66, E4:329.63, F4:349.23, G4:392.00, A4:440.00, B4:493.88,
        C5:523.25, D5:587.33, E5:659.26, F5:698.46, G5:783.99
      };

      const beat = 0.155;

      const melody = [
        ["G4",1],["G4",1],["G4",1],["C5",2],["E5",2],
        ["G4",1],["G4",1],["G4",1],["C5",2],["E5",2],
        ["C5",1],["C5",1],["B4",1],["B4",1],["A4",1],["A4",1],["G4",2],

        ["G4",1],["G4",1],["G4",1],["B4",2],["D5",2],
        ["G4",1],["G4",1],["G4",1],["B4",2],["D5",2],
        ["D5",1],["C5",1],["B4",1],["A4",1],["G4",1],["F4",1],["E4",1],["D4",2],

        ["C5",1],["C5",1],["D5",1],["D5",1],["E5",2],["E5",2],["C5",2],
        ["C5",1],["C5",1],["D5",1],["D5",1],["E5",2],["E5",2],["C5",2],

        ["E5",1],["E5",1],["F5",1],["F5",1],["G5",2],["E5",2],
        ["D5",1],["D5",1],["E5",1],["E5",1],["F5",2],["D5",2],

        ["C5",1],["B4",1],["A4",1],["G4",2],
        ["G4",1],["F4",1],["E4",3],

        ["G4",1],["G4",1],["A4",1],["B4",1],["C5",2],
        ["B4",1],["A4",1],["G4",2],["E4",2],
        ["G4",4]
      ];

      // Trumpet-ish synth
      function playTrumpet(freq, start, dur, vol=1.0){
        const amp = ac.createGain();
        const bp  = ac.createBiquadFilter();
        bp.type = "bandpass";
        bp.frequency.value = Math.min(1800, Math.max(700, freq * 2.6));
        bp.Q.value = 1.2;

        amp.gain.setValueAtTime(0.0001, start);
        amp.gain.exponentialRampToValueAtTime(0.95 * vol, start + 0.018);
        amp.gain.exponentialRampToValueAtTime(0.0001, start + dur + Math.min(0.12, dur*0.35));

        // Vibrato LFO
        const lfo = ac.createOscillator();
        const lfoGain = ac.createGain();
        lfo.type = "sine";
        lfo.frequency.value = 6.2;
        lfoGain.gain.value = Math.max(6, Math.min(18, freq * 0.014));
        lfo.connect(lfoGain);

        const o1 = ac.createOscillator();
        const o2 = ac.createOscillator();
        const o3 = ac.createOscillator();

        o1.type = "sawtooth";
        o2.type = "sawtooth";
        o3.type = "triangle";

        o1.frequency.value = freq;
        o2.frequency.value = freq * 1.01;
        o3.frequency.value = freq * 2.0;

        lfoGain.connect(o1.frequency);
        lfoGain.connect(o2.frequency);
        lfoGain.connect(o3.frequency);

        const mix = ac.createGain();
        mix.gain.value = 0.65;

        o1.connect(mix);
        o2.connect(mix);
        o3.connect(mix);

        mix.connect(bp);
        bp.connect(amp);
        amp.connect(master);

        lfo.start(start);
        o1.start(start); o2.start(start); o3.start(start);

        const stopAt = start + dur + 0.16;
        lfo.stop(stopAt);
        o1.stop(stopAt); o2.stop(stopAt); o3.stop(stopAt);
      }

      // Bass
      function playBass(freq, start, dur){
        const o = ac.createOscillator();
        o.type = "sine";
        const g = ac.createGain();
        g.gain.setValueAtTime(0.0001, start);
        g.gain.exponentialRampToValueAtTime(0.8, start + 0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, start + dur + 0.08);
        o.frequency.value = freq;
        o.connect(g);
        g.connect(master);
        o.start(start);
        o.stop(start + dur + 0.12);
      }

      // Drums
      function noiseBuffer(){
        const bufferSize = ac.sampleRate * 0.35;
        const buffer = ac.createBuffer(1, bufferSize, ac.sampleRate);
        const data = buffer.getChannelData(0);
        for (let i=0; i<bufferSize; i++){
          data[i] = (Math.random() * 2 - 1) * (1 - i / bufferSize);
        }
        return buffer;
      }
      const sharedNoise = noiseBuffer();

      function hat(time){
        const src = ac.createBufferSource();
        src.buffer = sharedNoise;
        const hp = ac.createBiquadFilter();
        hp.type = "highpass";
        hp.frequency.value = 7000;
        const g = ac.createGain();
        g.gain.setValueAtTime(0.12, time);
        g.gain.exponentialRampToValueAtTime(0.0001, time + 0.05);
        src.connect(hp); hp.connect(g); g.connect(master);
        src.start(time);
        src.stop(time + 0.06);
      }

      function snare(time){
        const src = ac.createBufferSource();
        src.buffer = sharedNoise;
        const bp = ac.createBiquadFilter();
        bp.type = "bandpass";
        bp.frequency.value = 1800;
        bp.Q.value = 0.9;

        const g = ac.createGain();
        g.gain.setValueAtTime(0.0001, time);
        g.gain.exponentialRampToValueAtTime(0.28, time + 0.005);
        g.gain.exponentialRampToValueAtTime(0.0001, time + 0.12);

        const o = ac.createOscillator();
        o.type = "triangle";
        o.frequency.setValueAtTime(190, time);
        const og = ac.createGain();
        og.gain.setValueAtTime(0.14, time);
        og.gain.exponentialRampToValueAtTime(0.0001, time + 0.08);

        src.connect(bp); bp.connect(g); g.connect(master);
        o.connect(og); og.connect(master);

        src.start(time);
        src.stop(time + 0.14);
        o.start(time);
        o.stop(time + 0.10);
      }

      function kick(time){
        const o = ac.createOscillator();
        o.type = "sine";
        const g = ac.createGain();

        o.frequency.setValueAtTime(140, time);
        o.frequency.exponentialRampToValueAtTime(55, time + 0.10);

        g.gain.setValueAtTime(0.0001, time);
        g.gain.exponentialRampToValueAtTime(0.55, time + 0.008);
        g.gain.exponentialRampToValueAtTime(0.0001, time + 0.14);

        o.connect(g); g.connect(master);
        o.start(time);
        o.stop(time + 0.16);
      }

      // Schedule
      const startAt = ac.currentTime + 0.08;

      let t = startAt;
      for (const [note, len] of melody){
        const dur = beat * len;
        playTrumpet(N[note], t, dur * 0.96, 1.0);

        if (len >= 2 && Math.random() < 0.22){
          playTrumpet(N[note], t + dur*0.55, beat*0.35, 0.55);
        }
        t += dur;
      }
      const endAt = t;

      const bar = beat * 4;
      let tb = startAt;
      while (tb < endAt + 0.001){
        playBass(N["G4"]/2, tb + beat*0, beat*0.9);
        playBass(N["D4"]/2, tb + beat*1, beat*0.9);
        playBass(N["G4"]/2, tb + beat*2, beat*0.9);
        playBass(N["D4"]/2, tb + beat*3, beat*0.9);

        kick(tb + beat*0);
        snare(tb + beat*1);
        kick(tb + beat*2);
        snare(tb + beat*3);

        for (let i=0;i<4;i++){
          hat(tb + beat*i);
          hat(tb + beat*i + beat*0.5);
        }

        tb += bar;
      }
    }

    // Confetti
    let confetti = [];
    let confettiOn = false;

    function startConfetti(){
      confettiOn = true;
      confetti = [];
      const count = Math.min(240, Math.floor(window.innerWidth / 3));

      for (let i=0; i<count; i++){
        confetti.push({
          x: Math.random() * window.innerWidth,
          y: -20 - Math.random() * window.innerHeight,
          r: 3 + Math.random() * 5,
          vx: -2 + Math.random() * 4,
          vy: 2 + Math.random() * 6,
          rot: Math.random() * Math.PI,
          vr: -0.15 + Math.random() * 0.3
        });
      }
      requestAnimationFrame(drawConfetti);
    }

    function drawConfetti(){
      if (!confettiOn) return;
      ctx.clearRect(0,0,window.innerWidth, window.innerHeight);

      for (const p of confetti){
        p.x += p.vx;
        p.y += p.vy;
        p.rot += p.vr;

        if (p.y > window.innerHeight + 30) {
          p.y = -20;
          p.x = Math.random() * window.innerWidth;
        }
        if (p.x < -30) p.x = window.innerWidth + 30;
        if (p.x > window.innerWidth + 30) p.x = -30;

        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);

        const hue = (p.x * 0.6 + p.y * 0.8) % 360;
        ctx.fillStyle = `hsl(${hue}, 90%, 60%)`;
        ctx.fillRect(-p.r, -p.r, p.r*2.2, p.r*1.2);

        ctx.restore();
      }
      requestAnimationFrame(drawConfetti);
    }

    // Party trigger
    yesBtn.addEventListener("click", async () => {
      document.body.classList.add("party");
      yay.classList.add("show");

      yesBtn.disabled = true;
      noBtn.disabled = true;
      noBtn.style.opacity = "0.6";
      noBtn.style.cursor = "not-allowed";
      yesBtn.style.cursor = "default";

      // Visa GIF + fade/pop in
      gifWrap.classList.add("show");

      // Om den redan √§r cachad laddas den direkt, annars k√∂rs fade n√§r den finns
      if (!danceGif.complete) {
        danceGif.addEventListener("load", () => {
          // klass finns redan, men detta hj√§lper i vissa browsers
          gifWrap.classList.add("show");
        }, { once:true });
      }

      startConfetti();
      await playLaCucarachaMariachi();
    });
  </script>
</body>
</html>
